<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ===============================
       BASIC PAGE SETUP
       =============================== -->
  <meta charset="UTF-8">
  <title>LADS Essay Portal</title>

  <!-- Pico CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">

  <!-- Responsive viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- ===============================
       CUSTOM STYLES
       =============================== -->
  <style>
    .hidden { display: none; }

    textarea {
      min-height: 150px;
      font-family: monospace;
    }

    article {
      margin-top: 2rem;
      padding: 1.5rem;
      border-radius: 0.75rem;
    }

    button.delete-btn { color: red; }
    button.edit-btn { color: blue; }

    nav.tabs ul {
      display: flex;
      gap: 1rem;
      list-style: none;
    }

    .essay-text {
      white-space: pre-wrap; /* keeps formatting */
    }

    /* Password eye icons */
    .eye {
      cursor: pointer;
      font-size: 1.2rem;
      margin-left: .5rem;
    }

    /* Password modal background */
    #passwordModal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #passwordModal article {
      max-width: 400px;
      width: 100%;
    }
  </style>
</head>

<body>

<main class="container">

  <!-- ==================================================
       LOGIN SECTION (CLUB PASSWORD)
       ================================================== -->
  <section id="login">
    <h2>Club Access</h2>

    <p>Enter the club password to continue.</p>

    <!-- Password input + eye toggle -->
    <div style="display:flex;align-items:center;">
      <input type="password" id="passwordInput" placeholder="Password">
      <span class="eye" onclick="togglePassword('passwordInput', this)">ðŸ™ˆ</span>
    </div>

    <button onclick="checkPassword()">Enter</button>
    <p id="error" style="color:red;"></p>
  </section>

  <!-- ==================================================
       MAIN CONTENT (HIDDEN UNTIL LOGIN)
       ================================================== -->
  <div id="content" class="hidden">

    <!-- ===============================
         TAB NAVIGATION
         =============================== -->
    <nav class="tabs">
      <ul>
        <li><a onclick="showSection('submitSection')">Submit Essay</a></li>
        <li><a onclick="showSection('viewSection')">View Essays</a></li>
      </ul>
    </nav>

    <!-- ===============================
         SUBMIT / EDIT ESSAY SECTION
         =============================== -->
    <section id="submitSection">

      <h2>Submit an Essay</h2>

      <!-- Author -->
      <input id="authorInput" type="text" placeholder="Your Name and Class">

      <!-- Genres -->
      <label>Select up to 3 genres</label>
      <select id="genresSelect" multiple>
        <option>Comedy</option>
        <option>Adventure</option>
        <option>Romance</option>
        <option>Life</option>
        <option>Horror</option>
        <option>Report</option>
        <option>Argumentative</option>
        <option>Persuasive</option>
        <option>Descriptive Works</option>
        <option>Formal Essay</option>
        <option>Complaint</option>
        <option>Letters</option>
      </select>

      <!-- File upload (TXT only â€“ safest client-side) -->
      <label>Upload Essay File (TXT only)</label>
      <input type="file" id="fileUpload" accept=".txt">

      <!-- Essay box -->
      <textarea id="essayText" placeholder="Write your essay here..."></textarea>

      <!-- Submit / Save button -->
      <button id="submitBtn" onclick="addEssay()">Submit Essay</button>
    </section>

    <!-- ===============================
         VIEW ESSAYS SECTION
         =============================== -->
    <section id="viewSection" class="hidden">

      <!-- Search -->
      <input type="search" id="searchInput"
             placeholder="Search by name or genre"
             oninput="loadEssays()">

      <!-- Essay output -->
      <div id="essayList"></div>
    </section>

  </div>
</main>

<footer class="container">
  <small>NAPARIMA COLLEGE â€¢ LADS</small>
</footer>

<!-- ==================================================
     PASSWORD MODAL (EDIT / DELETE)
     ================================================== -->
<div id="passwordModal" class="hidden">
  <article>
    <h3 id="modalTitle"></h3>

    <div style="display:flex;align-items:center;">
      <input type="password" id="modalPassword" placeholder="Enter password">
      <span class="eye" onclick="togglePassword('modalPassword', this)">ðŸ™ˆ</span>
    </div>

    <button onclick="confirmPassword()">Confirm</button>
    <button onclick="closeModal()">Cancel</button>
    <p id="modalError" style="color:red;"></p>
  </article>
</div>

<script>
/* =====================================================
   PASSWORD CONSTANTS (CHANGE HERE ONLY)
   ===================================================== */
const CLUB_PASSWORD   = "iwonderwhomadethis?";
const DELETE_PASSWORD = "DeLeTe-NB";
const EDIT_PASSWORD   = "EditEdit3P";

/* =====================================================
   GLOBAL STATE VARIABLES
   ===================================================== */
let pendingAction = null;   // holds edit/delete action
let editingIndex = null;    // index of essay being edited

/* =====================================================
   PASSWORD VISIBILITY TOGGLE
   ===================================================== */
function togglePassword(inputId, icon) {
  const input = document.getElementById(inputId);

  if (input.type === "password") {
    input.type = "text";
    icon.textContent = "ðŸ‘ï¸";
  } else {
    input.type = "password";
    icon.textContent = "ðŸ™ˆ";
  }
}

/* =====================================================
   LOGIN LOGIC
   ===================================================== */
function checkPassword() {
  if (passwordInput.value === CLUB_PASSWORD) {
    login.classList.add("hidden");
    content.classList.remove("hidden");
    showSection("submitSection");
    loadEssays();
  } else {
    error.textContent = "Incorrect password.";
  }
}

/* =====================================================
   TAB SWITCHING
   ===================================================== */
function showSection(id) {
  submitSection.classList.add("hidden");
  viewSection.classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

/* =====================================================
   PASSWORD MODAL CONTROLS
   ===================================================== */
function openModal(title, action) {
  modalTitle.textContent = title;
  modalPassword.value = "";
  modalError.textContent = "";
  pendingAction = action;
  passwordModal.classList.remove("hidden");
}

function closeModal() {
  passwordModal.classList.add("hidden");
}

function confirmPassword() {
  pendingAction(modalPassword.value);
}

/* =====================================================
   ADD ESSAY
   ===================================================== */
function addEssay() {
  const author = authorInput.value.trim();
  const text   = essayText.value.trim();
  const genres = [...genresSelect.selectedOptions].map(o => o.value);

  if (!author || !text || genres.length === 0 || genres.length > 3) {
    alert("Fill all fields correctly.");
    return;
  }

  const essays = JSON.parse(localStorage.getItem("essays")) || [];
  essays.push({ author, text, genres });
  localStorage.setItem("essays", JSON.stringify(essays));

  authorInput.value = "";
  essayText.value = "";
  genresSelect.selectedIndex = -1;

  showSection("viewSection");
  loadEssays();
}

/* =====================================================
   LOAD & DISPLAY ESSAYS
   ===================================================== */
function loadEssays() {
  essayList.innerHTML = "";
  const search = searchInput.value.toLowerCase();
  const essays = JSON.parse(localStorage.getItem("essays")) || [];

  essays
    .filter(e =>
      e.author.toLowerCase().includes(search) ||
      e.genres.join(" ").toLowerCase().includes(search)
    )
    .forEach((e, i) => {
      const article = document.createElement("article");
      article.innerHTML = `
        <h3>${e.author}</h3>
        <p><strong>Genres:</strong> ${e.genres.join(", ")}</p>
        <p class="essay-text">${e.text}</p>
        <button class="edit-btn" onclick="requestEdit(${i})">Edit</button>
        <button class="delete-btn" onclick="requestDelete(${i})">Delete</button>
      `;
      essayList.appendChild(article);
    });
}

/* =====================================================
   EDIT ESSAY (LOAD INTO FORM)
   ===================================================== */
function requestEdit(index) {
  openModal("Enter Edit Password", pwd => {
    if (pwd !== EDIT_PASSWORD) {
      modalError.textContent = "Incorrect password.";
      return;
    }

    const essays = JSON.parse(localStorage.getItem("essays"));
    const essay = essays[index];

    authorInput.value = essay.author;
    essayText.value = essay.text;

    [...genresSelect.options].forEach(opt => {
      opt.selected = essay.genres.includes(opt.value);
    });

    editingIndex = index;
    submitBtn.textContent = "Save Changes";
    submitBtn.onclick = saveEditedEssay;

    closeModal();
    showSection("submitSection");
  });
}

/* =====================================================
   SAVE EDITED ESSAY
   ===================================================== */
function saveEditedEssay() {
  const essays = JSON.parse(localStorage.getItem("essays"));

  essays[editingIndex] = {
    author: authorInput.value.trim(),
    text: essayText.value.trim(),
    genres: [...genresSelect.selectedOptions].map(o => o.value)
  };

  localStorage.setItem("essays", JSON.stringify(essays));

  editingIndex = null;
  submitBtn.textContent = "Submit Essay";
  submitBtn.onclick = addEssay;

  authorInput.value = "";
  essayText.value = "";
  genresSelect.selectedIndex = -1;

  showSection("viewSection");
  loadEssays();
}

/* =====================================================
   DELETE ESSAY
   ===================================================== */
function requestDelete(index) {
  openModal("Enter Delete Password", pwd => {
    if (pwd !== DELETE_PASSWORD) {
      modalError.textContent = "Incorrect password.";
      return;
    }

    const essays = JSON.parse(localStorage.getItem("essays"));
    essays.splice(index, 1);
    localStorage.setItem("essays", JSON.stringify(essays));

    closeModal();
    loadEssays();
  });
}

/* =====================================================
   FILE UPLOAD (TXT â†’ TEXTAREA)
   ===================================================== */
fileUpload.addEventListener("change", () => {
  const file = fileUpload.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = e => essayText.value = e.target.result;
  reader.readAsText(file);
});
</script>

</body>
</html>
